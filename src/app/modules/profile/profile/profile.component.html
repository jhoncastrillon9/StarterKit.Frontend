<c-row>
  <c-col xs="12">
    <c-card class="mb-4">
      <c-card-header>
        <strong>Mi Perfil</strong>
      </c-card-header>
      <c-card-body>
        <!-- Datos del usuario -->
        <c-row class="mb-4">
          <c-col md="12">
            <div class="text-center mb-4">
              <img src="./assets/img/avatars/3d_1.png" alt="Avatar" class="rounded-circle" style="width: 100px; height: 100px; object-fit: cover;">
            </div>
          </c-col>
        </c-row>

        <c-row class="mb-3">
          <c-col md="6">
            <div class="mb-3">
              <label cLabel class="fw-bold">Correo electrónico</label>
              <p class="form-control-plaintext">{{ userProfile?.email || 'No disponible' }}</p>
            </div>
          </c-col>
          <c-col md="6" *ngIf="userProfile?.name">
            <div class="mb-3">
              <label cLabel class="fw-bold">Nombre</label>
              <p class="form-control-plaintext">{{ userProfile?.name }}</p>
            </div>
          </c-col>
        </c-row>

        <c-row class="mb-3" *ngIf="userProfile?.role">
          <c-col md="6">
            <div class="mb-3">
              <label cLabel class="fw-bold">Rol</label>
              <p class="form-control-plaintext">{{ userProfile?.role }}</p>
            </div>
          </c-col>
        </c-row>

        <hr class="my-4">

        <!-- Sección de seguridad -->
        <c-row>
          <c-col xs="12">
            <h5 class="mb-3">
              <svg cIcon name="cilLockLocked" class="me-2"></svg>
              Seguridad
            </h5>
            <button cButton color="primary" (click)="openChangePasswordModal()">
              <svg cIcon name="cilSettings" class="me-2"></svg>
              Cambiar contraseña
            </button>
          </c-col>
        </c-row>
      </c-card-body>
    </c-card>
  </c-col>
</c-row>

<!-- Modal para cambiar contraseña -->
<c-modal [visible]="showChangePasswordModal" (visibleChange)="showChangePasswordModal = $event" alignment="center">
  <c-modal-header>
    <h5 cModalTitle>Cambiar contraseña</h5>
    <button cButtonClose (click)="closeChangePasswordModal()"></button>
  </c-modal-header>
  <c-modal-body>
    <!-- Mensaje de éxito -->
    <c-alert *ngIf="showSuccessMessage" color="success" [dismissible]="true" (visibleChange)="showSuccessMessage = $event">
      {{ successMessage }}
    </c-alert>

    <!-- Mensaje de error -->
    <c-alert *ngIf="showErrorMessage" color="danger" [dismissible]="true" (visibleChange)="showErrorMessage = $event">
      {{ errorMessage }}
    </c-alert>

    <form [formGroup]="changePasswordForm" (ngSubmit)="onChangePassword()">
      <div class="mb-3">
        <label cLabel for="currentPassword">Contraseña actual</label>
        <input 
          cFormControl 
          type="password" 
          id="currentPassword" 
          formControlName="currentPassword"
          placeholder="Ingresa tu contraseña actual"
          [valid]="f['currentPassword'].touched ? f['currentPassword'].valid : undefined">
        <c-form-feedback *ngIf="f['currentPassword'].touched && f['currentPassword'].errors?.['required']" [valid]="false">
          La contraseña actual es requerida
        </c-form-feedback>
        <c-form-feedback *ngIf="f['currentPassword'].touched && f['currentPassword'].errors?.['minlength']" [valid]="false">
          La contraseña debe tener al menos 6 caracteres
        </c-form-feedback>
      </div>

      <div class="mb-3">
        <label cLabel for="newPassword">Nueva contraseña</label>
        <input 
          cFormControl 
          type="password" 
          id="newPassword" 
          formControlName="newPassword"
          placeholder="Ingresa tu nueva contraseña"
          [valid]="f['newPassword'].touched ? f['newPassword'].valid : undefined">
        <c-form-feedback *ngIf="f['newPassword'].touched && f['newPassword'].errors?.['required']" [valid]="false">
          La nueva contraseña es requerida
        </c-form-feedback>
        <c-form-feedback *ngIf="f['newPassword'].touched && f['newPassword'].errors?.['minlength']" [valid]="false">
          La contraseña debe tener al menos 6 caracteres
        </c-form-feedback>
      </div>

      <div class="mb-3">
        <label cLabel for="confirmPassword">Confirmar nueva contraseña</label>
        <input 
          cFormControl 
          type="password" 
          id="confirmPassword" 
          formControlName="confirmPassword"
          placeholder="Confirma tu nueva contraseña"
          [valid]="f['confirmPassword'].touched ? f['confirmPassword'].valid : undefined">
        <c-form-feedback *ngIf="f['confirmPassword'].touched && f['confirmPassword'].errors?.['required']" [valid]="false">
          Debes confirmar la nueva contraseña
        </c-form-feedback>
        <c-form-feedback *ngIf="f['confirmPassword'].touched && f['confirmPassword'].errors?.['passwordMismatch']" [valid]="false">
          Las contraseñas no coinciden
        </c-form-feedback>
      </div>
    </form>
  </c-modal-body>
  <c-modal-footer>
    <button cButton color="secondary" (click)="closeChangePasswordModal()">Cancelar</button>
    <button cButton color="primary" (click)="onChangePassword()" [disabled]="changePasswordForm.invalid">
      Guardar cambios
    </button>
  </c-modal-footer>
</c-modal>

<ngx-spinner type="ball-scale-multiple"></ngx-spinner>
