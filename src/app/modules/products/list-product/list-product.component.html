<!-- Container Principal Moderno -->
<div class="product-list-container">
  <!-- Header Principal Moderno -->
  <div class="product-list-header">
    <div class="header-content">
      <div class="header-left">
        <div class="header-icon">
          <i class="fas fa-boxes"></i>
        </div>
        <div class="header-text">
          <h1 class="page-title">Productos</h1>
          <p class="page-subtitle">Gestiona y administra tu catálogo de productos</p>
        </div>
      </div>
      <div class="header-right">
        <div class="header-actions">
          <a [routerLink]="'/products/add'" class="btn-new-product">
            <i class="fas fa-plus"></i>
            <span>Nuevo Producto</span>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Stats Cards Row -->
  <div class="stats-row">
    <div class="stat-card stat-total">
      <div class="stat-icon">
        <i class="fas fa-cubes"></i>
      </div>
      <div class="stat-info">
        <span class="stat-value">{{ totalRecords }}</span>
        <span class="stat-label">Total Productos</span>
      </div>
    </div>
    <div class="stat-card stat-active">
      <div class="stat-icon">
        <i class="fas fa-box-open"></i>
      </div>
      <div class="stat-info">
        <span class="stat-value">{{ products.length }}</span>
        <span class="stat-label">En esta página</span>
      </div>
    </div>
  </div>

  <!-- Main Content Card -->
  <div class="product-list-card">
    <!-- Table Container -->
    <p-table #dt 
      class="product-table-modern" 
      styleClass="p-datatable-modern"        
      [value]="products" 
      [paginator]="true" 
      [rows]="pageSize"         
      [loading]="loading" 
      [rowHover]="true"
      [lazy]="true"
      [totalRecords]="totalRecords"
      (onLazyLoad)="onPageChange($event)"
      [rowsPerPageOptions]="[10, 20, 50, 100]"
      currentPageReportTemplate="{first} al {last} de {totalRecords} productos"
      [globalFilterFields]="['productId', 'name', 'description', 'price', 'productInternalCode']"
      [tableStyle]="{ 'min-width': '50rem' }">

      <!-- Caption / Search Bar -->
      <ng-template pTemplate="caption">
        <div class="table-header-modern">
          <div class="search-section">
            <div class="search-input-wrapper">
              <i class="fas fa-search search-icon"></i>
              <input 
                pInputText 
                type="text" 
                [(ngModel)]="searchValue" 
                (keyup.enter)="onSearch()"
                placeholder="Buscar por nombre, código, descripción..." 
                class="search-input"/>
              <button 
                *ngIf="searchValue" 
                class="clear-search-btn" 
                (click)="searchValue = ''; onSearch()">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <button class="btn-search" (click)="onSearch()">
              <i class="fas fa-search"></i>
              <span>Buscar</span>
            </button>
          </div>
          <div class="table-actions">
            <button 
              class="btn-filter-action" 
              (click)="clear(dt)"
              pTooltip="Limpiar filtros"
              tooltipPosition="bottom">
              <i class="fas fa-filter-circle-xmark"></i>
              <span>Limpiar</span>
            </button>
          </div>
        </div>
      </ng-template>

      <!-- Table Header -->
      <ng-template pTemplate="header">
        <tr class="table-header-row">
          <th pSortableColumn="productInternalCode" class="th-code">
            <div class="th-content">
              <i class="fas fa-barcode"></i>
              <span>Código</span>
              <p-sortIcon field="productInternalCode" />
            </div>
          </th>
          <th pSortableColumn="name" class="th-name">
            <div class="th-content">
              <i class="fas fa-tag"></i>
              <span>Nombre</span>
              <p-sortIcon field="name" />
            </div>
          </th>
          <th pSortableColumn="description" class="th-description">
            <div class="th-content">
              <i class="fas fa-align-left"></i>
              <span>Descripción</span>
              <p-sortIcon field="description" />
            </div>
          </th>
          <th pSortableColumn="price" class="th-price">
            <div class="th-content">
              <i class="fas fa-dollar-sign"></i>
              <span>Precio</span>
              <p-sortIcon field="price" />
            </div>
          </th>
          <th class="th-actions">
            <div class="th-content">
              <i class="fas fa-cog"></i>
              <span>Acciones</span>
            </div>
          </th>
        </tr>
      </ng-template>

      <!-- Table Body -->
      <ng-template pTemplate="body" let-product>
        <tr class="table-body-row">
          <td class="td-code">
            <span class="code-badge">{{ product.productInternalCode }}</span>
          </td>
          <td class="td-name">
            <div class="name-wrapper">
              <span class="product-name">{{ product.name }}</span>
            </div>
          </td>
          <td class="td-description">
            <span class="product-description" [pTooltip]="product.description" tooltipPosition="top">
              {{ product.description | truncate:50 }}
            </span>
          </td>
          <td class="td-price">
            <span class="price-badge">{{ formatPrice(product.price) }}</span>
          </td>
          <td class="td-actions">
            <div class="action-buttons">
              <button 
                pButton 
                type="button" 
                class="btn-action btn-duplicate"
                (click)="duplicateProduct(product)"
                pTooltip="Duplicar producto"
                tooltipPosition="bottom">
                <i class="fas fa-copy"></i>
              </button>
              <button 
                pButton 
                type="button" 
                class="btn-action btn-edit"
                (click)="goToEdit(product)"
                pTooltip="Editar producto"
                tooltipPosition="bottom">
                <i class="fas fa-pencil-alt"></i>
              </button>
              <button 
                pButton 
                type="button" 
                class="btn-action btn-delete"
                (click)="confirmDelete(product)"
                pTooltip="Eliminar producto"
                tooltipPosition="bottom">
                <i class="fas fa-trash-alt"></i>
              </button>
            </div>
          </td>
        </tr>
      </ng-template>

      <!-- Empty Message -->
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5" class="empty-message">
            <div class="empty-state">
              <div class="empty-icon">
                <i class="fas fa-box-open"></i>
              </div>
              <h3>No se encontraron productos</h3>
              <p>Intenta con otros términos de búsqueda o crea un nuevo producto</p>
              <a class="btn-new-product-empty" [routerLink]="'/products/add'">
                <i class="fas fa-plus"></i>
                <span>Nuevo Producto</span>
              </a>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>

<!-- Modal de Confirmación -->
<app-confirmation-modal 
  #confirmationModal
  [title]="title"
  [messageModal]="messageModal"
  [isModalError]="isModalError"
  [isConfirmation]="isModalForDelete"
  [titleButtonComfimationYes]="'Eliminar'"
  (confirmAction)="onModalConfirm()">
</app-confirmation-modal>

<ngx-spinner 
  bdColor="rgba(0, 0, 0, 0.8)" 
  size="medium" 
  color="#fff" 
  type="ball-clip-rotate" 
  [fullScreen]="true">
  <p style="color: white">Cargando...</p>
</ngx-spinner>
